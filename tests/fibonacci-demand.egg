(datatype Expr 
  (Num i64)
  (Add Expr Expr))

(function Fib (i64) Expr)

(rewrite (Add (Num a) (Num b)) (Num (+ a b)))
(rewrite (Fib x) (Add (Fib (- x 1)) (Fib (- x 2)))
         :when ((> x 1)))
(rewrite (Fib x) (Num x)
         :when ((<= x 1)))

(define f7 (Fib 7))
(run 1000)
(extract f7)
(check (= f7 (Num 13)))
       
 